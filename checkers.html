<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>WebAppDev by zbowhay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS Style For This Page -->
    <style>

      #gameCanvas{
        display: block;
        position:absolute;
        margin: auto;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        overflow: hidden; /* Disable scrollbars */
      }

      body{
        background-color: #555;
      }

    </style>
    <!-- end of CSS -->
  </head>

  <body>
    <!-- Body will hold the game canvas -->
    <canvas id="gameCanvas"></canvas>
    
    <script type="text/javascript">
    
    // Variables...
     var

     canvas,
     ctx,
     width,
     height,

     readyState = false,
     pieceSelected = [false, 0],
     checkerPieceArray,

     //Image vars
     background,
     redChips,
     blackChips,
     redChipsSelected,
     blackChipsSelected,
     aSquare,

     redTurn = true;

     // RUN THE PROGRAM!

     main();

     function main(){
      // because the images are loaded dynamically with javascript
      // the code needs to fully iterate itself one time before 
      // all of the necessary data is loaded/ready for game play
      // to begin.  Therefore, readyState is here to inform the
      // program when that has been accomplished.
      if(readyState == false)
      {
        init();
      }
      else // readyState == true // Begin gameplay
      {
        window.alert("red goes first!");
        //checkerPieceArray[9].availableMoves(9);
      }
     }

     // CHECKERPIECE CLASS

     function checkerPiece(name, team, imagesrc){
      this.name = name;
      this.team = team;
      this.image = null;
      this.imageSource =  imagesrc;
      this.imageLoaded = false;
      this.x = null;
      this.y = null;
      this.boardX = null;
      this.boardY = null;



      this.sayName = function(){
        window.alert(this.name);
      }

      this.setName = function(name){
        this.name = name;
      };

      this.setTeam = function(teamColor){
        this.team = teamColor;
      };

      this.createImage = function(){
        this.image = new Image();
        this.image.onload = function(){
          this.imageLoaded = true;
        };
        this.image.src = this.imageSource;
      };

      this.setX = function(x){
        this.x = x;
      };

      this.setY = function(y){
        this.y = y;
      };

      this.setBoardX = function(x){
        this.boardX = x;
      };

      this.setBoardY = function(y){
        this.boardY = y;
      };

      this.printAttributeInfo = function(arrayPosition){
        window.alert('Information about checkerPieceArray[' + arrayPosition + '] object: \n' + 
        'Team: ' + checkerPieceArray[arrayPosition].team + '\n' +
        'Name: ' + checkerPieceArray[arrayPosition].name + '\n' +
        'ImageSource: ' + checkerPieceArray[arrayPosition].imageSource + '\n' +
        'X: ' + checkerPieceArray[arrayPosition].x + '\n' +
        'Y: ' + checkerPieceArray[arrayPosition].y + '\n' +
        'BoardX: ' + checkerPieceArray[arrayPosition].boardX + '\n' +
        'BoardY: ' + checkerPieceArray[arrayPosition].boardY);
      };

      // check for available moves around checkerPiece
      this.availableMoves = function(n){
        var aMoves = [true, true, true, true];

        // gather up potential moves
        var pMoves = [[checkerPieceArray[n].boardX - 1, checkerPieceArray[n].boardY - 1],// top left
        [checkerPieceArray[n].boardX + 1, checkerPieceArray[n].boardY - 1],// top right
        [checkerPieceArray[n].boardX - 1, checkerPieceArray[n].boardY + 1],// bottom left
        [checkerPieceArray[n].boardX + 1, checkerPieceArray[n].boardY + 1]];// bottom right
        
        // Evalute potential moves
        // check to see if move is off board
        for(u = 0; u < pMoves.length; u++){
          if(pMoves[u][0] < 0 || pMoves[u][0] > 7 || pMoves[u][1] < 0 || pMoves[u][1] > 7){
            aMoves[u] = false;
          }
        }

        
        // check to see if other chips are already placed around this chip
        for(i = 0; i < checkerPieceArray.length; i++){
          for(j = 0; j < pMoves.length; j++){
            if(pMoves[j][0] == checkerPieceArray[i].boardX && pMoves[j][1] == checkerPieceArray[i].boardY){
              // this means that there is a checker piece already located in an adjacent location to the selected chip and therefore it cannot be moved to that location
              aMoves[j] = false;
            }
          }
        }
        // debug to show the effects of evaluating 
        /*for(k = 0; k < aMoves.length; k++){
          window.alert(aMoves[k]);
        }*/

        return [aMoves, pMoves];
      };
     }

     // FUNCTIONS


     // INSERT FUNCTION
     function insert(index, string, thisString) {
      if (index > 0)
      return thisString.substring(0, index) + string + thisString.substring(index, thisString.length);
      else
      return string + thisString;
      };


      // MAIN INIT FUNCTION
     function init(){

      // Initialize Canvas
      canvas = document.getElementById("gameCanvas");
      canvas.addEventListener("touchstart", touchDown, false);
      canvas.addEventListener("mousedown", mouseDown, false);
      
      width = window.innerWidth;
      height = window.innerHeight;

      if(width >=750){
        width = 750;
        height = width;
      }

      canvas.style.border = "1px solid #000";
      canvas.width = width;
      canvas.height = height;
      ctx = canvas.getContext("2d");

      // Init checkerPiece game objects array
      initCheckerPieceArray();

      //Draw the starting layout of game to canvas

      background = new Image();
      redChips = checkerPieceArray[12].image;
      blackChips = checkerPieceArray[0].image;
      redChipsSelected = new Image();
      blackChipsSelected = new Image();
      aSquare = new Image();


      background.src = 'Images/CheckerBoard.jpg';
      redChips.src = checkerPieceArray[12].imageSource;
      blackChips.src = checkerPieceArray[0].imageSource;
      redChipsSelected.src = 'Images/RedCheckerSelected.png';
      blackChipsSelected.src = 'Images/BlackCheckerSelected.png';
      aSquare.src = 'Images/availableSquare.png';

      // Wait for background/other images to load before drawing to canvas
      background.onload = function()
      {
        // draw background
        ctx.drawImage(background,0,0, width, height);

        // draw checker pieces and assign images to checkerPieceArray objects.
        
        var pieceNumber = 0;
        // used to track the images as they are assigned to their respective checkerPieceArray objects.

        var loopCount = 0;
        var placementCount = 0;
        var everyOther;

        for(var j = 0; j < height; j += (height/8)){

          // used to track which rows to draw the chips on.
          loopCount++;
           // probably not a necessary variable

          for(var i = 0; i < width; i += (width/8)){
            
            placementCount++;
            // used to skip spots on the board that shouldn't have a chip placed

            // FOR BLACK CHIPS
            if(loopCount <= 3)
            {
              if(loopCount == 1 || loopCount == 3)
              {
                if(placementCount == 1 || placementCount == 3 || placementCount == 5|| placementCount == 7) // draw chips in correct places for row 1 & 3
                {
                  // draw checker piece to screen
                  ctx.drawImage(blackChips, i, j, (width/8), (height/8));

                  // image coordinates for each checker piece
                  checkerPieceArray[pieceNumber].setX(i);
                  checkerPieceArray[pieceNumber].setY(j);

                  // board location coordinates for each checker piece
                  checkerPieceArray[pieceNumber].setBoardX(returnBoardX(i));
                  checkerPieceArray[pieceNumber].setBoardY(returnBoardY(j));
                  
                  // add one to pieceNumber to help keep track of which location/images are being assigned to checkerPieceArray[].
                  pieceNumber++;
                }
              }
              else // loopCount == 2
              {
                if(placementCount == 2 || placementCount == 4 || placementCount == 6 || placementCount == 8) // draw chips in correct places for row 2
                {
                  // draw checker piece to screen
                  ctx.drawImage(blackChips, i, j, (width/8), (height/8));

                  // image coordinates for each checker piece
                  checkerPieceArray[pieceNumber].setX(i);
                  checkerPieceArray[pieceNumber].setY(j);

                  // board location coordinates for each checker piece
                  checkerPieceArray[pieceNumber].setBoardX(returnBoardX(i));
                  checkerPieceArray[pieceNumber].setBoardY(returnBoardY(j));

                  // add one to pieceNumber to help keep track of which location/images are being assigned to checkerPieceArray.
                  pieceNumber++;
                }
              }
            }
            else // FOR RED CHIPS
            {
              if(loopCount == 6 || loopCount == 8)
              {
                if(placementCount == 2 || placementCount == 4 || placementCount == 6 || placementCount == 8)// draw chips in correct places for row 6 & 8
                {
                  // draw checker piece to screen
                  ctx.drawImage(redChips, i, j, (width/8), (height/8));

                  // image coordinates for each checker piece
                  checkerPieceArray[pieceNumber].setX(i);
                  checkerPieceArray[pieceNumber].setY(j);

                  // board location coordinates for each checker piece
                  checkerPieceArray[pieceNumber].setBoardX(returnBoardX(i));
                  checkerPieceArray[pieceNumber].setBoardY(returnBoardY(j));

                  // add one to pieceNumber to help keep track of which location/images are being assigned to checkerPieceArray.
                  pieceNumber++;
                }
              }
              else // loopCount == 7
              {
                if(placementCount == 1 || placementCount == 3 || placementCount == 5 || placementCount == 7)// draw chips in correct places for row 7
                {
                  // draw checker piece to screen
                  ctx.drawImage(redChips, i, j, (width/8), (height/8));

                  // image coordinates for each checker piece
                  checkerPieceArray[pieceNumber].setX(i);
                  checkerPieceArray[pieceNumber].setY(j);

                  // board location coordinates for each checker piece
                  checkerPieceArray[pieceNumber].setBoardX(returnBoardX(i));
                  checkerPieceArray[pieceNumber].setBoardY(returnBoardY(j));

                  // add one to pieceNumber to help keep track of which location/images are being assigned to checkerPieceArray.
                  pieceNumber++;
                }
              }
            }
          }

          if(loopCount == 3) // skip middle two rows
          {
            j += 2*(height/8);
            loopCount++; // skipped two loopCounts so they need to be added here.
            loopCount++;
          }
          placementCount = 0;
        }
        // after background .onload has run, change readyState and reiterate through main() so that game can progress with all data loaded.
        readyState = true;
        main();
      };

      // not necessary for functionality
      // initBoardArray();
     }


      // INITCHECKERPIECEARRAY FUNCTION
      function initCheckerPieceArray(){
      checkerPieceArray = [];
      var nameString;
      window.alert("creating checkerPieceArray...");
      for(a = 0; a < 24; a++)
      {

        if(a < 12)
        {
          nameString = 'black' + a;
          checkerPieceArray.push(new checkerPiece(nameString, 'black', 'Images/BlackChecker.png'));
          checkerPieceArray[a].createImage();
        }
        else
        {
          nameString = 'red' + a;
          checkerPieceArray.push(new checkerPiece(nameString, 'red', 'Images/RedChecker.png'));
          checkerPieceArray[a].createImage();
        }
      } 
     }


     //INITBOARDARRAY FUNCTION
     // not a necessary function
     function initBoardArray(){
      var boardArray = [];

      var boardArrayString = "";

      for (var i = 0; i < 8; i++) {
        for(var j = 0; j < 8; j++){
          boardArray.push([i,j]);
        }
        //Visual representation of Checker board array in a String for dev.
        if(i > 0){
          boardArrayString += boardArray.toString().substring(i*(4*8),(i+1)*(4*8)) + "\n";
        }else{
          boardArrayString += boardArray.toString() + "\n";
        }
      };

      // Visual representation of Checker board boardArray for development
      for(var a = 0; a < boardArrayString.length; a = a + 4){
        var temp = a;
        temp += 4;
        if(temp > boardArrayString.length){
         break;
        }
        else if(a == 0){
          boardArrayString = insert(0,"[", boardArrayString);
          a++;
        }
        else{
          boardArrayString = insert(a,"][", boardArrayString);
          a += 2;
        }
      }

      // For Development Purposes
      window.alert("INIT BOARD ARRAY: \n " + boardArrayString);
     }


     // returns board X location based on image X coordinates
     function returnBoardX(pxX){
      if(pxX < (width/8)){
        return 0; 
      }
      else if(pxX < ((width/8)*2)){
        return 1;
      }
      else if(pxX < ((width/8)*3)){
        return 2;
      }
      else if(pxX < ((width/8)*4)){
        return 3;
      }
      else if(pxX < ((width/8)*5)){
        return 4;
      }
      else if(pxX < ((width/8)*6)){
        return 5;
      }
      else if(pxX < ((width/8)*7)){
        return 6;
      }
      else if(pxX < width){
        return 7;
      }
      else{
        window.alert("Something went wrong with returnBoardX");
      }
      return null;
     }

     // returns board Y location based on image Y coordinates
     function returnBoardY(pxY){
      if(pxY < (height/8)){
        return 0;
      }
      else if(pxY < ((height/8)*2)){
        return 1;
      }
      else if(pxY < ((height/8)*3)){
        return 2;
      }
      else if(pxY < ((height/8)*4)){
        return 3;
      }
      else if(pxY < ((height/8)*5)){
        return 4;
      }
      else if(pxY < ((height/8)*6)){
        return 5;
      }
      else if(pxY < ((height/8)*7)){
        return 6;
      }
      else if(pxY < height){
        return 7;
      }
      else{
        window.alert("Something went wrong with returnBoardX");
      }
      return null;
     }

     function checkerPieceArrayDebug(pieceNumber){
      window.alert("checkerPieceArray Debug: \n"
       + "checkerPieceArray[" + pieceNumber + "] X = " + checkerPieceArray[pieceNumber].boardX + "\n"
       + "checkerPieceArray[" + pieceNumber + "] Y = " + checkerPieceArray[pieceNumber].boardY);
     }

    // EVENT CONTROLLERS

     function touchDown(){
      event.preventDefault();
      canvas_x = event.targetTouches[0].pageX;
      canvas_y = event.targetTouches[0].pageY;

      // necessary for tablets

      canvas_x -= canvas.offsetLeft;
      canvas_y -= canvas.offsetTop;
      //window.alert("X = " + canvas_x + ", Y = " + canvas_y);

      if(checkerPieceSelected(canvas_x, canvas_y) == true){
        redraw();
      }
     }

     function mouseDown(){
      canvas_x = event.x;
      canvas_y = event.y;

      canvas_x -= canvas.offsetLeft;
      canvas_y -= canvas.offsetTop;

      //window.alert("X = " + canvas_x + ", Y = " + canvas_y);
      //make sure no other pieces are already selected
      if(pieceSelected[0] == false){
        //detect if click landed on a checker piece
        if(checkerPieceSelected(canvas_x, canvas_y) == true){
          pieceSelected[0] = true;
          redraw();
          drawAvailableMoves(pieceSelected[1]);
        }
      }
      else // checker piece already selected
      {
        // do something
      }
     }

     function mouseDownOnPiece(){
     // this.
     }

     function cleanUpInit(){

     }

     function checkerPieceSelected(x, y){
      // represents an individual box area on the board
      var box;
      // load box[] with coordinates that belong to each checker piece
      if(redTurn == true){
        for(i = 12; i < checkerPieceArray.length; i++){
          var x1, x2, y1, y2;
          x1 = checkerPieceArray[i].x;
          x2 = x1 + (width/8);
          y1 = checkerPieceArray[i].y;
          y2 = y1 + (height/8);
          box = [x1, x2, y1, y2];
          // check if click was within the box area around checker piece
          if(x >= box[0] && x <= box[1]){
            if(y >= box[2] && y <= box[3]){
              //update image source of chip clicked on with "selected" image of itself
              selectedImage(i);
              pieceSelected[1] = i;
              return true;
            }
          }
        }
      }
      else // redTurn == false
      {
        for(i = 0; i < checkerPieceArray.length/2; i++){
        var x1, x2, y1, y2;
        x1 = checkerPieceArray[i].x;
        x2 = x1 + (width/8);
        y1 = checkerPieceArray[i].y;
        y2 = y1 + (height/8);
        box = [x1, x2, y1, y2];
        // check if click was within the box area around checker piece
        if(x >= box[0] && x <= box[1]){
          if(y >= box[2] && y <= box[3]){
            //update image source of chip clicked on with "selected" image of itself
            selectedImage(i);
            pieceSelected[1] = i;
            return true;
          }
        }
      }
      }
      
      return false;
     }

     function redraw(){
      // draw background over old board
      ctx.drawImage(background, 0, 0, width, height);
      // redraw all checker pieces
      for(i = 0; i < checkerPieceArray.length; i++){
        ctx.drawImage(checkerPieceArray[i].image, checkerPieceArray[i].x, checkerPieceArray[i].y, (width/8),(height/8));
      }
     }

     function drawAvailableMoves(i){
      // draw availableSquare.png around selected checker piece
      var moves = checkerPieceArray[i].availableMoves(i);
      var aMoves = moves[0];
      var pMoves = moves[1];
      for(i = 0; i < aMoves.length; i++){
        // if move is available then draw aSquare to that location on the canvas
        if(aMoves[i] == true){
          ctx.drawImage(aSquare, pMoves[i][0] * (width/8), pMoves[i][1] * (height/8), (width/8), (height/8));
        }
      }
     }

     // simply used to change image source of a checkerpiece to its selected couterpart and then refresh that checker piece's image object
     function selectedImage(i){
      // blackCheckerSelected
      if(i < 12){
        checkerPieceArray[i].imageSource = "Images/BlackCheckerSelected.png";
        checkerPieceArray[i].createImage();
      }
      else // redCheckerSelected
      {
        checkerPieceArray[i].imageSource = "Images/RedCheckerSelected.png";
        checkerPieceArray[i].createImage();
      }
     }

    </script>
  </body>
</html>
